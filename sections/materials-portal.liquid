{% comment %}
Materials Portal — TLK
Homepage grid of material tiles with a subtle 3D/glow hover.
Safe for Atelier / OS2.0. No theme CSS edits required.
{% endcomment %}
<section class="tlk-materials-portal" style="position:relative;padding:clamp(28px,4vw,56px) 0;background:{{ section.settings.bg }};color:{{ section.settings.text_color }}">
  <div class="tlk-container" style="width:min(1200px,92%);margin:0 auto;">
    {% if section.settings.heading != blank %}
      <h2 style="font-family:'Bodoni Moda',serif;font-size:clamp(28px,4.5vw,48px);line-height:1.1;margin:0 0 8px 0;">
        {{ section.settings.heading }}
      </h2>
    {% endif %}
    {% if section.settings.subheading != blank %}
      <p style="max-width:65ch;opacity:.9;margin:0 0 28px 0;">{{ section.settings.subheading }}</p>
    {% endif %}

    {% assign cols_d = section.settings.columns_desktop | default: 3 %}
    {% assign cols_m = section.settings.columns_mobile | default: 1 %}
    <div class="tlk-grid"
         style="
           display:grid;gap:clamp(12px,2vw,20px);
           grid-template-columns:repeat({{ cols_m }}, minmax(0,1fr));
         ">
      {% for block in section.blocks %}
        {% if block.type == 'card' %}
          {% assign title = block.settings.title %}
          {% assign url = block.settings.url %}
          {% assign image = block.settings.image %}
          {% assign tag = block.settings.tag %}
          {% assign desc = block.settings.desc %}

          <a {% if url != blank %}href="{{ url }}"{% endif %}
             class="tlk-card"
             style="text-decoration:none;color:inherit;display:block;overflow:hidden;border-radius:18px; position:relative; isolation:isolate; transform-style:preserve-3d; perspective:1000px;">
            <div class="tlk-media"
                 style="
                   position:relative;aspect-ratio:
                     {% case section.settings.card_ratio %}
                       {% when 'land' %} 16 / 9
                       {% when 'port' %} 3 / 4
                       {% else %} 1 / 1
                     {% endcase %};
                   border-radius:18px; overflow:hidden;
                   background:#0c0c0c;">
              {% if image != blank %}
                <img src="{{ image | image_url: width: 1800 }}"
                     srcset="{{ image | image_srcset }}"
                     sizes="(min-width: 1000px) calc((100vw - 8rem)/{{ cols_d }}), 92vw"
                     alt="{{ title | escape }}"
                     loading="lazy"
                     style="width:100%;height:100%;object-fit:cover;display:block;transform:translateZ(0);">
              {% else %}
                <div style="position:absolute;inset:0;display:grid;place-items:center;opacity:.6;">
                  <span>No image</span>
                </div>
              {% endif %}

              <!-- glow -->
              <div class="tlk-glow"
                   style="position:absolute;inset:0;border-radius:inherit;pointer-events:none;
                          box-shadow:0 0 0 transparent; transition:box-shadow .35s ease;"></div>

              <!-- overlay text -->
              <div class="tlk-overlay"
                   style="position:absolute;inset:0;display:flex;align-items:end;justify-content:space-between;
                          padding:clamp(12px,2.2vw,20px);background:linear-gradient(180deg, rgba(0,0,0,0) 40%, rgba(0,0,0,.55) 100%);
                          color:#fff;">
                <div>
                  {% if tag != blank %}
                    <span style="display:inline-block;font-size:12px;letter-spacing:.06em;opacity:.8;margin-bottom:6px;background:rgba(255,255,255,.08);padding:.25rem .5rem;border-radius:999px;">{{ tag }}</span>
                  {% endif %}
                  <div style="font-family:'Bodoni Moda',serif;font-size:clamp(18px,2.2vw,28px);line-height:1.1;">{{ title }}</div>
                  {% if desc != blank %}
                    <div style="font-size:14px;opacity:.85;margin-top:6px;max-width:45ch;">{{ desc }}</div>
                  {% endif %}
                </div>
                <div aria-hidden="true" style="font-size:20px;opacity:.9;transform:translateZ(25px)">↗</div>
              </div>
            </div>
          </a>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <script>
    (function(){
      // responsive columns on desktop
      const grid = document.currentScript.previousElementSibling.previousElementSibling;
      const colsD = {{ cols_d | json }};
      const mq = window.matchMedia('(min-width: 900px)');
      function applyCols(){ grid.style.gridTemplateColumns = mq.matches ? `repeat(${colsD},minmax(0,1fr))` : grid.style.gridTemplateColumns; }
      applyCols(); mq.addEventListener?.('change', applyCols);

      // hover glow & subtle lift
      grid.querySelectorAll('.tlk-card').forEach(card=>{
        const glow = card.querySelector('.tlk-glow');
        card.addEventListener('pointerenter', ()=> {
          card.style.transition='transform .35s ease';
          card.style.transform='translateY(-2px)';
          glow.style.boxShadow = '0 20px 60px {{ section.settings.glow | default: "rgba(16,59,88,.35)" }}';
        });
        card.addEventListener('pointerleave', ()=> {
          card.style.transform='translateY(0)';
          glow.style.boxShadow = '0 0 0 transparent';
        });
      });
    })();
  </script>
</section>

{% schema %}
{
  "name": "Materials Portal",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Materials" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Explore the fibers and finishes behind each piece." },
    { "type": "range", "id": "columns_desktop", "min": 2, "max": 4, "step": 1, "label": "Columns (desktop)", "default": 3 },
    { "type": "select", "id": "columns_mobile", "label": "Columns (mobile)", "default": "1", "options": [{"value":"1","label":"1"},{"value":"2","label":"2"}] },
    { "type": "select", "id": "card_ratio", "label": "Card image ratio", "default": "square",
      "options": [
        {"value":"square","label":"Square"},
        {"value":"land","label":"Landscape 16:9"},
        {"value":"port","label":"Portrait 3:4"}
      ]
    },
    { "type": "color", "id": "bg", "label": "Background", "default": "#000000" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#F0F0EC" },
    { "type": "text", "id": "glow", "label": "Glow (CSS color/rgba)", "default": "rgba(16,59,88,.35)" }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Material card",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "title", "label": "Title", "default": "Supima® Cotton" },
        { "type": "text", "id": "tag", "label": "Tag (optional)", "default": "Natural Fiber" },
        { "type": "textarea", "id": "desc", "label": "Short description", "default": "Long-staple softness, strength, and sheen." },
        { "type": "url", "id": "url", "label": "Link URL" }
      ]
    }
  ],
  "presets": [{ "name": "Materials Portal" }]
}
{% endschema %}
